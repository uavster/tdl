;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Routines for DMA data transfers
;       Ignacio Mellado Bataller ( B52 / the DarkRising )
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

; DMA mode bits
DMA_DEMAND      EQU 0 SHL 6
DMA_SIGNAL      EQU 1 SHL 6
DMA_BLOCK       EQU 2 SHL 6
DMA_CASCADE     EQU 3 SHL 6

DMA_AUTOINIT    EQU 1 SHL 4

; DMA operation bits
DMA_VERIFY      EQU 0 SHL 2
DMA_WRITE       EQU 1 SHL 2
DMA_READ        EQU 2 SHL 2

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Initializes DMA extensions
;
; OUTPUT : CF = 0 if ok
;               EAX = NULL
;          CF = 1 if error
;               EAX = Error code
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  InitDMA : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Closes DMA extensions
;
; OUTPUT : CF = 0 if ok
;               EAX = NULL
;          CF = 1 if error
;               EAX = Error code
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  CloseDMA : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Allocates a DMA buffer (64Kb aligned) and maintains a list of all allocated
; buffers for freeing
;
; INPUT  : ECX = Buffer size
;
; OUTPUT : CF = 0 if ok
;               EBX -> DMA buffer aligned on 64Kb boundaries
;          CF = 1 if no memory for buffer
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  AllocDMABuffer : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Frees a DMA buffer
;
; INPUT  : EBX -> DMA buffer returned by AllocDMABuffer
; OUTPUT : CF = 0 if ok
;          CF = 1 if error freeing
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  FreeDMABuffer : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; "DMA_Setup"   PROGRAM A CHANNEL ON THE 8237 DMA CONTROLLER                
;             A general routine to program the DMA controler.               
;                                                                           
; By Adam Seychell                                                          
;                                                                           
;                                                                           
; INPUT:        AL    Mode Register  ( bits 0..1 ignored )                  
;               AH    channel   ( 0..7 )                                    
;               EBX   Physical Base Address ( 0..0ffffffh )                 
;               ECX   Bytes to transfer     ( 1..10000h )                   
;                                                                           
;                                                                           
;Destroys:  EAX, EDX & ECX                                                  
;                                                                           
;        code has been optimized and fully tested.                          
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  DMASetup : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Programs DMA chip to write to a device
;
; INPUT : EAX = DMA channel to use
;         EBX = Physical base address to make transfer from
;         ECX = Bytes to transfer
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  DMAWriteToDevice : NEAR

;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
; Programs DMA chip to read from a device
;
; INPUT : EAX = DMA channel to use
;         EBX = Physical base address to make transfer to
;         ECX = Bytes to transfer
;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
global  DMAReadFromDevice : NEAR



